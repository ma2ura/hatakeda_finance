[
  {
    "objectID": "Hatakeda_Chap03.html",
    "href": "Hatakeda_Chap03.html",
    "title": "3  統計",
    "section": "",
    "text": "3.1 期待値と分散(標準偏差)の推定\n前章で学習したように，ファイナンスではいろいろな理由から，資産価値それ自体より資産価値の変化率，すなわちリターン(return)で議論することが多いです。 ここで，リターンの定義を再度確認します。\nでは，トヨタ自動車の終値の日次データを用いて，株式リターンの値動きをグラフにしてみましょう。 ggplotパッケージのgeom_line()を用いて折れ線グラフを作成します。\nトヨタ自動車の2021年における株価の急落は，株式分割が原因です。 このとき，トヨタ自動車は1株を5株に分割しています。 そのため約10000円だった株価が約2000円と5分の1に下落したのです。\n次にこのデータから株式リターンを計算し、折れ線グラフにしてみます。\n2021年の株式分割時の下落が異常な値となっていますが，それ以外の値動きは0を中心にランダムになっていることが分かります。\nある資産の価格やリターンを確率変数とみなしたとき，その背後にある確率分布の特徴を表す指標(つまり母数)を実際に観察することは不可能です。母集団のパラメータは観察不能なのです。 しかしながら，過去の観測値の集合であるデータを用いて，確率分布の特徴やそれらの指標(期待値，分散，標準偏差)の推定値を求めることはできます。そこで，推定値を用いて確率変数の特徴を考察するようにします。\n例えば，データから作成されるヒストグラム(histogram)や度数分布表は確率変数を特徴付ける確率分布の仮想となります。 期待値，分散，標準偏差の推定値は，確率変数を特徴付ける母平均(期待値)，母分散，母標準偏差の仮想です。 この期待値，分散，標準偏差の推定値は，より具体的に標本平均(期待値)，標本分散，標本標準偏差とよばれます。 ただし「標本」という言葉はしばしば省略されることが多いので注意しましょう。\nt-1からt-Tまでの期間における資産iの標本期待(平均)リターン\\bar r_iは，\n\\begin{align}\n\\bar r_i = \\frac 1T \\sum _{k=1}^T r_{i,t-k}\n\\end{align}\n となります。\nRの基本関数だとmean()で計算できます。 たとえば，トヨタの株式リターンの平均は次の通りです。\nmean(df$r_daily[df$企業名 == \"トヨタ自動車\"], na.rm = TRUE)\n\n[1] 0.000225068\nこのコードの意味するところは，mean()で引数のベクトルの平均を計算しています。 引数のdf$r_dailyとすることで，dfというデータフレームのr_dailyという変数をしていしています。 さらに，[df$企業名 == \"トヨタ自動車\"]と続けることで，dfの企業名が\"トヨタ自動車\"となる行のみを抽出しています。 最後のna.rm = TRUEは，平均を出そうとするベクトルに欠損値が含まれている場合，その欠損値を除外して平均を計算することを意味しています。\n計算されたトヨタ自動車の期待リターンは，2.145399e-05となりました。 これは指数表記で科学研究よく利用される書き方です。 数式で表現すると，\n2.145399 \\times 10^{-5}\nのことで，具体的には，0.00002145399ということです。\n標本(不偏)分散は，観測値x_kとその標本平均\\bar Xからの乖離の単純平均である。\nt-1からt-Tまでの期間における資産iのリターンの標本分散s^2[r_i]は，次の通りである。\n\\begin{aligned}\ns^2[r_i] = \\frac{1}{T-1} \\sum_{k=1}^T ( r_{i,t-k} - \\bar r_i)^2\n\\end{aligned}\nRの基本関数だとvar()で計算できます。 たとえば，トヨタの株式リターンの標本分散は次の通りです。\nvar(df$r_daily[df$企業名 == \"トヨタ自動車\"], na.rm = TRUE)\n\n[1] 0.0003337524\n標本標準偏差は，分散の平方根です。\nt-1からt-Tまでの期間における資産iのリターンの標本標準偏差s[r_i]は，次の通りである。\n\\begin{align}\ns [r_i] = \\sqrt{s^2 [r_i]}\n\\end{align}\nRの基本関数で標準偏差を返す関数はsd()です。 たとえば，トヨタの株式リターンの標本標準偏差は次の通りです。\nsd(df$r_daily[df$企業名 == \"トヨタ自動車\"], na.rm = TRUE)\n\n[1] 0.01826889\nデータから確率分布の特性を表す指標にはほかにも色々あります。 たとえば尖度や歪度などです。尖度(skewness)とは，確率分布の尖り具合を表す指標です。 歪度(kurtosis)とは，確率分布の裾の重さを表す指標です。\n多様な統計量から分布の特徴を捉えることも重要ですが、グラフの1つであるヒストグラム(histogram)は数値よりも直観的に分布の形を確認できるため，まず度数分布表やヒストグラムを作成することをお勧めします。 Rの基本関数でヒストグラムを作成するにはhist()を用います。 いままでと同様に、トヨタ自動車の株式リターンのヒストグラムを作成してみましょう。\npar(family = \"HiraKakuProN-W3\") # macの文字化け対策 winの人はコメントアウト\nhist(df$r_daily[df$企業名 == \"トヨタ自動車\"]) # 基本関数でヒストグラム\nこれでももちろんヒストグラムを作成することはできるのですが、 よりキレイなグラフを作成したいなら、tidyverseのggplot2パッケージが便利です。 ただし，ggplot2で利用できるデータの型はdata.frame型に限るので注意しましょう。\nまず、作図のためのデータを用意します。 トヨタ自動車の日次リターンと日付を抽出し、data.frame型に変換して，df_toyotaという変数に格納します。\ndf_toyota &lt;- df %&gt;%\n    filter(企業名 == \"トヨタ自動車\") %&gt;%\n    select(date, r_daily)\nつぎに，ggplot()関数で作図してみます。 ggplot2パッケージでは，以下の要素を指定してグラフを作ります。\nたとえば，geom_histogram()関数を用いるとヒストグラムを作成できます。\ng &lt;- ggplot(df_toyota) + # データを指定\n    aes(x = r_daily) +  # 変数を指定\n    geom_histogram() # グラフを指定\ng &lt;- g + xlim(-0.1, 0.1) + mystyle # x軸の範囲を指定\ng &lt;- g + xlab(\"日次リターン\") + ylab(\"度数\") # x軸とy軸のラベルを指定\nprint(g) # 出力\n正規分布のように左右対称の分布になっていることが分かります。\nここまでの学習から，1変数の離散確率変数の特徴を表す指標として，期待値，分散，標準偏差を学習し，またデータの分布を視覚的に把握するグラフとしてヒストグラムの作り方を学習しました。 それぞれの定義，計算方法，作図方法を理解し，説明できるようになっていれば，この節は終了です。 次節から，2変数間の関係を表す統計量について学習します。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>統計</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap03.html#期待値と分散標準偏差の推定",
    "href": "Hatakeda_Chap03.html#期待値と分散標準偏差の推定",
    "title": "3  統計",
    "section": "",
    "text": "(標本)単純平均\n\n\n\n観測値x_kの単純平均値は， \n\\begin{aligned}\n\\bar X = \\frac 1T \\sum_{k=1}^T x_k\n\\end{aligned}\n となる。 ここでTは観測値の数(これを標本サイズという)を表します。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n標本分散\n\n\n\n\n\\begin{aligned}\ns^2 [X] = \\frac{1}{T-1} \\sum _{k=1} (x_k - \\bar X)^2\n\\end{aligned}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n標本標準偏差\n\n\n\n\n\\begin{align}\ns [X] = \\sqrt{s^2[X]}\n\\end{align}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nggplot()関数でデータを指定\naes()関数でx軸とy軸の変数を指定\ngeom_***関数でグラフの種類を指定",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>統計</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap03.html#共分散と相関係数の推定",
    "href": "Hatakeda_Chap03.html#共分散と相関係数の推定",
    "title": "3  統計",
    "section": "3.2 共分散と相関係数の推定",
    "text": "3.2 共分散と相関係数の推定\n2つの確率変数間の特徴を表す指標として、共分散(covariance)と相関係数(correlation coefficient)を学習します。 いま，観察される確率変数XとZの実現値の組(x_i, z_i), i = 1, \\dots , Nがデータとして手元にあるとします。 ここで，Nは標本サイズを表しています。つまりN個のデータの組があるということです。 このN個のデータを座標平面上で表したものを散布図(scatter diagram)といいます。 たとえば、トヨタ自動車と日産自動車の株式リターンの散布図を作成してみましょう。\n\nview(df)\ndf %&gt;%\n    filter(企業名 == \"トヨタ自動車\" | 企業名 == \"日産自動車\") %&gt;%\n    select(企業名, date, r_daily) %&gt;%\n    pivot_wider(names_from = 企業名, values_from = r_daily) %&gt;%\n    ggplot() + aes(x = トヨタ自動車, y = 日産自動車) + geom_point() + mystyle\n\n\n\n\n\n\n\n\nこの散布図から，トヨタ自動車と日産自動車の株式リターンはどちらかの株式リターンが増加したら，もう片方も増加する，という関係にあるといえます。 この関係の強さを数値で表したものが共分散や相関係数となります。 共分散は，次のように定義される。\n\n\n\n\n\n\n共分散\n\n\n\n共分散の定義は，\n\n\\begin{aligned}\ns_{XZ} = \\frac{1}{N} \\sum_{i=1}^N (x_i - \\bar X)(z_i - \\bar Z)\n\\end{aligned}\n\n\n\n共分散は，XとZの標本平均からの乖離の単純平均となります。 図で示すと，次のようになります。 \n\ndf %&gt;%\n    filter(企業名 == \"トヨタ自動車\" | 企業名 == \"日産自動車\") %&gt;%\n    select(企業名, date, r_daily) %&gt;%\n    pivot_wider(names_from = 企業名, values_from = r_daily) %&gt;%\n    ggplot() + aes(x = トヨタ自動車, y = 日産自動車) + geom_point() + mystyle +\n    geom_vline(xintercept = mean(df$r_daily[df$企業名 == \"トヨタ自動車\"], na.rm = TRUE), linetype = \"dashed\",color = \"red\") +\n    geom_hline(yintercept = mean(df$r_daily[df$企業名 == \"日産自動車\"], na.rm = TRUE), linetype = \"dashed\", color = \"red\")\n\n\n\n\n\n\n\n\nこの第1象限(右上)に位置する実現値の組(x_i, z_i)は，x_i &gt; \\bar Xかつz_i &gt; \\bar Zであり，また第3象限(左下)の領域の点もx_i &lt; \\bar Xかつz_i &lt; \\bar Zであるため，(x_i - \\bar X)(z_i - \\bar Z)は正の値をとります。 つまり，第1象限と第3象限の点の組み合わせが多いとき，共分散の値を正にする方向に寄与し，第2象限と第4象限は負に寄与します。 よってトヨタ自動車と日産自動車の株式リターンの共分散は正になることが予想されます。 では計算してみましょう。\n\ndf_cov &lt;- df %&gt;%\n    filter(企業名 == \"トヨタ自動車\" | 企業名 == \"日産自動車\") %&gt;%\n    select(企業名, date, r_daily) %&gt;% # 変数を選択\n    pivot_wider(names_from = 企業名, values_from = r_daily) %&gt;% # 横データに\n    drop_na() # 欠損値を削除\n(cov_toyota_nissan &lt;- cov(df_cov$トヨタ自動車, df_cov$日産自動車))\n\n[1] 0.0003021892\n\n\nトヨタ自動車と日産自動車の株式リターンの共分散は3^{-4}となり，正の値であることが分かりました。 共分散は2変数間の関係をします尺度ですが、その値の大きさは単位に依存するという問題があります。 そこで、共分散を標準化したものが相関係数です。 相関係数は、共分散を各変数の標準偏差で割ったものです。\n\n\n\n\n\n\n相関係数\n\n\n\n相関係数の定義は，\n\n\\begin{aligned}\n\\rho_{XZ} = \\frac{\\mathbb{COV}[XZ]}{s[X] \\times  s[Z]}\n\\end{aligned}\n\n\n\n相関係数は変数の単位に依存せず、-1 \\leq \\rho_{XZ} \\leq 1の値をとる尺度で、2変数間の関係の強さを表します。 相関係数が1に近いほど正の相関が強く、-1に近いほど負の相関が強いといえます。 また、相関係数が0に近いほど2変数間の関係は弱いといえます。\n標本相関係数\\rho _{XZ}が0.5の場合、以下のような散布図になります。\n\nX &lt;- rnorm(1000, mean = 0, sd = 1)\nZ &lt;- 0.5 * X + rnorm(1000, mean = 0, sd = 1)\ndf &lt;- data.frame(X, Z)\nggplot(df) + aes(x = X, y = Z) + geom_point() + mystyle\n\n\n\n\n\n\n\n\n標本相関係数\\rho _{XZ}が0.90の場合、以下のような散布図になります。\n\nX &lt;- rnorm(1000, mean = 0, sd = 1)\nZ &lt;- 0.9 * X + rnorm(1000, mean = 0, sd = 1)\ndf &lt;- data.frame(X, Z)\nggplot(df) + aes(x = X, y = Z) + geom_point() + mystyle\n\n\n\n\n\n\n\n\n標本相関係数\\rho _{XZ}が-0.6の場合、以下のような散布図になります。\n\nX &lt;- rnorm(1000, mean = 0, sd = 1)\nZ &lt;- -0.6 * X + rnorm(1000, mean = 0, sd = 1)\ndf &lt;- data.frame(X, Z)\nggplot(df) + aes(x = X, y = Z) + geom_point() + mystyle\n\n\n\n\n\n\n\n\n無相関，つまり標本相関係数\\rho _{XZ}が0の場合、以下のような散布図になります。\n\nX &lt;- rnorm(1000, mean = 0, sd = 1)\nZ &lt;- rnorm(1000, mean = 0, sd = 1)\ndf &lt;- data.frame(X, Z)\nggplot(df) + aes(x = X, y = Z) + geom_point() + mystyle\n\n\n\n\n\n\n\n\n注意しないといけないのは，相関係数が線形関係を前提とした尺度であることです。もし2変数の関係が非線形である場合は，相関係数は役に立ちません。 たとえば，いかのような有名な図があります。\n\nggplot(datasaurus_dozen) + aes(x = x, y = y, color = dataset) + geom_point() + facet_wrap(~dataset, ncol = 3) + theme_bw() + theme(panel.grid = element_blank()) + mystyle\n\n\n\n\n\n\n\n\nアニメーションにするとこうなります。 gganimateパッケージのtransition_states()関数を用いてアニメーションを作成しています。\n\nggplot(datasaurus_dozen, aes(x = x, y = y))+\n  geom_point() + theme_minimal() +\n  transition_states(dataset, 3, 1)\n\n\n\n\n\n\n\n\nこの散布図のデータの基本統計量はほぼ同じで，相関係数はほぼ0のデータですが，実際に散布図として可視化してみると全く異なるデータであることがわかります。 つまりは，手元のデータは一度可視化して，そのデータの特徴をつかむことが重要なのです。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>統計</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap03.html#変数のアフィン変換",
    "href": "Hatakeda_Chap03.html#変数のアフィン変換",
    "title": "3  統計",
    "section": "3.3 変数のアフィン変換",
    "text": "3.3 変数のアフィン変換\n線形変換(linear transformation)とは，線形性をもつ変換で， \nf(\\boldsymbol{x}) = \\boldsymbol{A}\\boldsymbol{x}\n と表し，線形変換は，\n\n直線を維持したまま，\n原点を固定\n\nした変換となります。この線形変換fに平行移動gを合成した変換をアフィン変換(affine transformation)といいます。\n確率変数の一次変換あるいは線形変換、より一般的にはアフィン変換について学習します。 一般に確率変数Xのアフィン変換は以下のように表されます。\n\n\\begin{aligned}\ny = f \\circ g (\\boldsymbol{x}) = \\boldsymbol{A}\\boldsymbol{x} + \\boldsymbol{b}\n\\end{aligned}\n\n以下では，ある確率変数Xに対して，行列\\boldsymbol{A}がスカラーa，ベクトル\\boldsymbol{b}がスカラーbの場合を考えます。 つまり， \nY = a X + b\n である場合について考えます。 このとき，変換後の確率変数Yの期待値と分散は以下のようになります。\n\n\\begin{aligned}\n\\mathbb{E}[Y] &= a\\mathbb{E}[X] + b \\\\\n\\mathbb{V}[Y] &= a^2 \\mathbb{V}[X] \\\\\n\\mathbb{SD}[Y] &= |a| \\mathbb{SD}[X]\n\\end{aligned}\n\n以下の例で確認してみましょう。 従業員9名の1ヶ月の労働時間Xが以下の表に示されている。\n\nlabor &lt;- data.frame(\n    従業員 = c(\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\"),\n    労働時間 = c(30,45,50,35,60,70,55,60,45)\n)\nknitr::kable(t(labor), booktabs = TRUE)\n\n\n\n\n従業員\nA\nB\nC\nD\nE\nF\nG\nH\nI\n\n\n労働時間\n30\n45\n50\n35\n60\n70\n55\n60\n45\n\n\n\n\n\n\n総賃金Y_2は毎月の固定給100千円に時間給Y_1(時給3千円)を合わせた額として支給される。 すなわち，Y_2 = 100 + Y_1 = 100 + 3Xの関係が成立している。 したがって，各従業員の労働時間と賃金は以下の通りとなる。\n\nlabor &lt;- labor %&gt;%\n    mutate(\n        時間給 = 労働時間 * 3,\n        総賃金 = 100 + 時間給\n    )\nknitr::kable(t(labor), booktabs = TRUE)\n\n\n\n\n従業員\nA\nB\nC\nD\nE\nF\nG\nH\nI\n\n\n労働時間\n30\n45\n50\n35\n60\n70\n55\n60\n45\n\n\n時間給\n90\n135\n150\n105\n180\n210\n165\n180\n135\n\n\n総賃金\n190\n235\n250\n205\n280\n310\n265\n280\n235\n\n\n\n\n\nこの表からわかることは，Y_1=3Xであることから，Y_1の標本平均と標本標準偏差はともにXの標本平均と標本標準偏差の3倍になっている，ということです。 つまり，標本平均と標本標準偏差はともに比例的に変化していることがわかります。\n\n\nこのデータを元に，労働時間，時間給，総賃金の標本平均や標本標準偏差を計算してみましょう。 \n\nlabor_summary &lt;- labor %&gt;%\n    summarise(\n        平均 = c(mean(労働時間), mean(時間給), mean(総賃金)),\n        標準偏差 = c(sd(労働時間), sd(時間給), sd(総賃金))\n    )\nlabor_summary$変数名 &lt;- c(\"労働時間\", \"時間給\", \"総賃金\")\nlabor_summary &lt;- labor_summary %&gt;%\n    select(変数名, 平均, 標準偏差)\nknitr::kable(labor_summary, booktabs = TRUE, digits = 2)\n\n\n\n\n変数名\n平均\n標準偏差\n\n\n\n\n労働時間\n50\n12.75\n\n\n時間給\n150\n38.24\n\n\n総賃金\n250\n38.24\n\n\n\n\n\n総賃金はY_2 = 100 + Y_1であるため，総賃金Y_2の標本平均は時間給Y_1の標本平均に100を加えたものになります。 また総賃金Y_2の標本標準偏差は、時間給Y_1と同じである。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>統計</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap03.html#変数の線形結合",
    "href": "Hatakeda_Chap03.html#変数の線形結合",
    "title": "3  統計",
    "section": "3.4 変数の線形結合",
    "text": "3.4 変数の線形結合\nより一般的に線形結合について考えてみましょう。 いま、k個の変数X_1,\\dots ,X_kから一次結合Y = c_0 + c_1 X_1 + \\cdots + c_k X_kで表される変数Yにおいて(ただしcはパラメータ)，データから計算される変数Yの標本平均，標本分散(標本標準偏差)に対して次の関係が成立します。\n\n\\begin{aligned}\n\\mathbb{E}[Y] &= \\mathbb{E}[c_0 + c_1 X_1 + \\cdots + c_k X_k ]\\\\\n            &= c_0 + c_1 \\mathbb{E}[X_1] + \\cdots + c_k\\mathbb{E}[ X_k ] \\\\\n            &= c_0 + c_1 \\bar{X}_1 + \\cdots + c_k\\bar{X}_k \\\\\n\\mathbb{V}[Y] &= \\mathbb{V}[c_0 + c_1 X_1 + \\cdots + c_k X_k ]\\\\\n&= c_0 + \\mathbb{V}[c_1 X_1] + \\cdots + \\mathbb{V}[c_k X_k ] + \\sum _{i \\not = j}^k  \\sum _{j \\not = i}^k c_i c_j s_{ij}(X_i,X_j)\\\\\n&= c_0 + c_1^2\\mathbb{V}[X_1] + \\cdots + c_k^2\\mathbb{V}[X_k ] + \\sum _{i \\not = j}^k  \\sum _{j \\not = i}^k c_i c_j s_{ij}(X_i,X_j)\n\\mathbb{V}[Y] &= a^2 \\mathbb{V}[X] \\\\\n\\mathbb{SD}[Y] &= |a| \\mathbb{SD}[X]\n\\end{aligned}\n\n\n\\begin{aligned}\n\\bar Y &= c_0 + c_1 \\bar X_1 + \\cdots + c_k \\bar X_k \\\\\ns^2[Y] &= c_1^2 s^2[X_1] + \\cdots + c_k^2 s^2[X_k] + \\sum _{i \\not = j}^k \\sum _{j \\not = i}^k c_i c_j s_{ij}(X_i,X_j)\n\\end{aligned}\n\nここで，\\bar X_i，s^2[X_i], s_{ij}(X_i,X_j)はそれぞれ標本平均，標本分散，標本共分散を表す。\nk=2の場合，\n\n\\begin{align}\n\\bar Y &= c_0 + c_1 \\bar X_1 + c_2 \\bar X_2 \\\\\ns^2[Y] &= c_1^2 s^2[X_1] + c_2^2 s^2[X_2] + 2 c_1 c_2 s_{12}(X_1,X_2)\n\\end{align}\n となる。\n\n\n\n\n\n\n例2\n\n\n\nk=2のケースで，Y=0.5X_1 + 0.5 X_2の期待値および分散を求める。 ただし，\\bar X_1 = 0.07，s^2[X_1] = 1.48，\\bar X _2 = -0.02，s^2 [X_2] = 1.46である。\n\n無相関(s _{ij} (X_i,X_j) = 0)のケース \n  \\begin{aligned}\n  \\bar Y   &= 0.5 \\times 0.07 + 0.5 \\times - 0.02 = 0.025\\\\\n  s^2 [Y]  &= 0.5^2 \\times 1.48 + 0.5^2 \\times 1.46 + 2 \\times 0.5 \\times 0.5 \\times 0 = 0.735\n  \\end{aligned}\n  \nYの分散は，X_1とX_2の分散よりも小さい。\n負の相関($s _{ij}(X_i,X_j) = -1.46 $)のケース\n\n  \\begin{aligned}\n  \\bar Y   &= 0.5 \\times 0.07 + 0.5 \\times - 0.02 = 0.025\\\\\n  s^2 [Y]  &= 0.5^2 \\times 1.48 + 0.5^2 \\times 1.46 + 2 \\times 0.5 \\times 0.5 \\times -1.46 = 0.005\n  \\end{aligned}\n  \nYの分散は，X_1とX_2の分散よりも小さい。\n\nX_1とX_2の共分散は，Yの分散に影響を与える。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>統計</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap04.html",
    "href": "Hatakeda_Chap04.html",
    "title": "4  効用",
    "section": "",
    "text": "4.1 効用関数\nいままでで、確率と統計の基礎を学習したので、つぎは効用について学習します。 次章から学ぶポートフォリオ理論では、投資家と投資対象の2つをモデル化し、最適な投資意思決定について考えます。\n投資対象として株式や債券を中心に学習しますが、それらの投資対象をモデル化するさいに重要なことは、投資対象がもつリスクをどのように捉えるか、ということです。 そこでは、確率分布を用いてリスクをモデル化しました。つまり、投資対象がもたらすリターンのばらつきが大きい、つまり分散(あるいは標準偏差)が大きいとき、その投資対象はリスクが高い、とします。\nつぎに投資対象に投資する主体である投資家の投資対象に対する選好をモデル化する必要があります。 ここに効用が登場します。\nこの節では，以下の項目について学習します。\nファイナンスはリスクについて考える学問といえます。そして個人が負担するリスクを考える際、個人がリスクに対してどのような態度を持っているのか、を表現する必要があります。 そこで用いられる概念が効用(utility)となります。\n株式の例で考えてみましょう。\n第3章で学習したの知識を用いて，株式AとBの期待値と標準偏差を求めてみましょう。 資産AとBの期待値は， \n\\begin{aligned}\n\\mathbb{E}[A] &= \\frac 12 \\times 100 + \\frac 12 \\times 50 = 75\\\\\n\\mathbb{E}[B] &= \\frac 12 \\times 120 + \\frac 12 \\times 40 = 80\n\\end{aligned}\n となり，資産Bの方が期待値が大きいことがわかります。 つぎに標準偏差を計算してみると， \n\\begin{aligned}\n\\sigma  [A] &= \\sqrt{ \\frac 12 \\times (100  - 75)^2 + \\frac 12 \\times (50 - 75)^2} = 25\\\\\n\\sigma  [B] &= \\sqrt{ \\frac 12 \\times (120  - 80)^2 + \\frac 12 \\times (40 - 80)^2} = 40\n\\end{aligned}\n となり，資産Bの方が標準偏差が大きいことがわかります。 資産価格の標準偏差や分散を，(risk)や(volatility)とよぶことがあります。 つまり，資産Bは期待リターンが高いが，リスクも高い投資先であることがわかりました。\n例2より，株式AはBよりも期待値は低くリスクも低い，そして株式BはAより期待値が高いもののリスクも高い，ということがわかりました。 では投資家は株式Aと株式Bのどちらの株式(1単位)を購入するのだろうか？ このとき，投資家の(risk preference)により，投資家がどちらの投資先をより好むのか，を考えることができます。\nこのリスク選好を表現するために，効用関数を用いる。\n財を消費することで得られる満足度を効用(utility)と呼び， 効用Uと財の消費量Xの関係を記述した関数を効用関数(utility function)といいます。 効用関数は実数値関数(real-valued function)，つまり消費量Xを実数に写像する関数です。 \n\\begin{aligned}\nU :X \\mapsto \\mathbb{R}\n\\end{aligned}\n効用関数の形状で，経済主体(ここでは投資家)の財Xに対する選好(preference)を表すことができます。 ファイナンスでは，財Xとして，財の消費量の代わりに，富の大きさを用いることもあります(実は，富の大きさではなく，変化率(リターン)がよく利用されるのですが)。 先の例でいえば，将来の株価が50円になったときの効用水準はU(50)であり，100円になったときの効用水準はU(100)で表されます。\nまず，重要な効用関数の性質について説明します。\n効用関数が微分可能であることを仮定すると，単調性は \nU'(X) \\geq 0\nで表せます。\n効用関数が2階微分可能であることを仮定すると，限界効用の低減は， \nU''(X) \\leq 0\n を意味している。\nこれをグラフにすると以下のようになります。\nlibrary(tidyverse)\nlibrary(ggthemes)\nlibrary(patchwork)\nrequire(fontregisterer)\nrequire(systemfonts)\nmystyle &lt;- list (#  ggplotのテーマ\n  theme_few(),\n  theme(\n    text = element_text(\n      size=16,  #  フォントサイズ\n     family = \"HiraKakuProN-W3\" # ヒラギノフォント\n    )\n  )\n)\ndf &lt;- data.frame(\n    X &lt;- seq(0, 300, 1),\n    U &lt;- 300*X - X^2\n)\nggplot(df) + aes(x = X, y = U) + geom_path() + xlim(0,140) + mystyle",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>効用</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap04.html#効用関数",
    "href": "Hatakeda_Chap04.html#効用関数",
    "title": "4  効用",
    "section": "",
    "text": "リスクを回避する投資家は，株式Aを購入\nリスクを好む投資家は，株式Bを購入\n\n\n\n\n\n\n\n\n\n\n\n単調性(monotonicity)\n\n\n\n消費財や富の量が多いほど，効用は大きくなります。 つまり効用関数は消費や富の増加関数(increasing function)です。\n\n\n\n\n\n\n\n\n\n\n限界効用の低減\n\n\n\n消費財や富の量が大きくなるほど，追加的に得られる1円あたりの消費や富がもたらす効用の増分が小さくなる，という仮定します。 つまり効用関数は凹関数(concave function)である，ということです。\n\n\n\n\n\n\n\n\n\n例3：性質1と性質2を満たす効用関数の例\n\n\n\n\n\\begin{aligned}\nU(X)   &= 300 X - X^2\\\\\nU'(X)  &= 300 - 2X \\geq 0  \\quad \\mathrm{for } \\quad x \\leq 150\\\\\nU''(X) &= -2 &lt; 0\n\\end{aligned}\n\n\n\n\n\n\n\n4.1.1 期待効用最大化原理\n数学者フォン・ノイマン(Von Neumann)と経済学者オスカー・モルゲンシュテルン(Oskar Morgenstern)によれば，一定の前提条件の下において，合理的な投資家は複数の投資案件からの選択にあたって最大の期待効用をもたらす投資案件を選択する，行動原理を構築しています。 このような期待効用に基づく投資家の選択行動を期待効用最大化原理とよんでいます。\n\n\n\n\n\n\n例4\n\n\n\n効用関数がU(X)=300X-X^2である場合，先の数値例に基づいて期待効用を計算する。\n\n\\begin{aligned}\n\\mathbb{E}[U(A)] &= \\frac 12 \\times U(100) + \\frac 12 \\times U(50)\\\\\n          &= \\frac 12 \\times 20,000 + \\frac 12 \\times 12,500 = 16,250\\\\\n\\mathbb{E}[U(B)] &= \\frac 12 \\times U(120) + \\frac 12 \\times U(40)\\\\\n          &= \\frac 12 \\times 21,600 + \\frac 12 \\times 10,400 = 16,000\n\\end{aligned}\n したがって， \n\\mathbb{E}[U(A)] \\geq \\mathbb{E}[U(B)]\n であるため，投資家は株式Aを購入する。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>効用</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap04.html#効用関数とリスク回避",
    "href": "Hatakeda_Chap04.html#効用関数とリスク回避",
    "title": "4  効用",
    "section": "4.2 効用関数とリスク回避",
    "text": "4.2 効用関数とリスク回避\n確実なリターンを見込める債券投資とリターンが不確実な株式投資の2つの投資先について考えてみます。\n\n\n\n\n\n\n例1の株式\n\n\n\n例1の株式Aがもたらす利益の期待値は、 \n\\mathbb{E}[A] = \\frac 12 \\times 100 + \\frac 12 \\times 50 = 75\n でした。 株式Aの利益の期待値である75を確実に得られる債券Z_Aの(期待)効用は、 \nU( \\mathbb{E}[A]) ] = U(75) = 300 \\times 75 - 75^2 = 16875\n となります。 利益が不確実な株式Aの期待効用は，\n\n\\begin{aligned}\n\\mathbb{E}[ U (A)] &= \\frac 12 U(100) + \\frac 12 U(50)\\\\\n            &= \\frac 12 \\times 20000 + \\frac 12 \\times 12500\\\\\n            &= 16250\n\\end{aligned}\n となります。 つまり債券投資がもたらす期待値の効用U(\\mathbb{E}[A])よりも，株式投資がもたらす期待効用\\mathbb{E}[U(A)]の方が小さいため， 期待効用最大化の原理より，投資家は(不確実な)資産Aよりも確実な債権Z_Aを購入する、ということになります。\n\n\n期待値が同じなら，投資家はリスクの少ない投資先を選択するのです。 効用関数が性質2を満たす限り，どのような投資資産Xを考えても，\n\n\\begin{aligned}\n\\mathbb{E}[U(X)] \\leq U(\\mathbb{E}[X])\n\\end{aligned}\n\nが成立する。この不等式をイェンセンの不等式(Jensen’s inequality)とよび、非常に重要な性質となります。 このような効用関数を持つ投資家をリスク回避的(risk averse)な投資家とよびます。\n\n\n\n\n\n\nイェンセンの不等式\n\n\n\nイェンセンの不等式は，凸関数の性質を表しています。 凸関数(convex function)とは，2点を結んだ線分が関数のグラフよりも上にあるような関数のことです。 実数値関数fが凸関数であるとは，任意のx_1, x_2 \\in \\mathbb{R}と任意の\\lambda \\in [0,1]に対して， \nf(\\lambda x_1 + (1-\\lambda)x_2) \\leq \\lambda f(x_1) + (1-\\lambda)f(x_2)\n が成立することをいいます。 図にすると、次のようになります。\n\ndf &lt;- data.frame(\n    X &lt;- seq(0, 300, 1),\n    U &lt;- 300*X - X^2\n)\nx1 &lt;- 30\nx2 &lt;- 130\ng &lt;- ggplot(df) + aes(x = X, y = U) + geom_path() + xlim(0,140) + mystyle\ng &lt;- g + geom_segment(aes(x = x1, y = U[x1], xend = x2, yend = U[x2]), color = \"red\", size = 1)\ng &lt;- g + geom_point(aes(x = x1, y = U[x1]), color = \"red\", size = 1)\ng &lt;- g + geom_point(aes(x = x2, y = U[x2]), color = \"red\", size = 1)\nprint(g)\n\n\n\n\n\n\n\n\n\n\n効用関数の形状が投資家のリスクに対する選好を表します。 リスク回避的な投資家は，平均的に同じ消費(富)を得るならば，確実なものを選好します。\n上の「例1の株式」の例を図示すると以下のようになります。 この株式Aがもたらす利益の期待値は75でした。 この投資家の効用関数は，\n\nU(X) = 300X - X^2\n\nでした。 上で計算したとおり，好景気時の利益100を得た場合の効用U(100) = 20,000で，不景気の利益50を得た場合の効用U(50)は12500です。それぞれ確率50％で生じるので，期待効用\\mathbb{E}(U(X)]は16250でした。\nこの株式の期待利益75を確実に得ることができる場合の効用U(75)は16875となり，期待効用\\mathbb{E}(U(X)]よりも大きくなります。つまりこの投資家はリスク(つまり結果のばらつき)を回避する傾向があるということです。\n\n\n\n\n\n\n\n\n\n次に，リスク愛好型(risk lover)の効用関数をもつ投資家について考えてみましょう。 リスク愛好的な投資家とは，どのような株式投資Xを考えても，\n\n\\begin{aligned}\n\\mathbb{E}[U(X)] \\geq U(\\mathbb{E}[X])\n\\end{aligned}\n\nが成立する投資家をいいます。 先のリスク回避的な投資家とは対照的に，リスク愛好的な投資家は，同じ消費(富)を得るならば，不確実なものを選好します。 つまり，確実にもらえる100万円より，当たると200万，外れると0円といったギャンブルを好む投資家のことです。 このような投資家を想定することはほとんど無いため，ここでは詳細な説明は省略します。\n\n\n\n\n\n\n\n\n\nリスク中立的(risk-neutral)な効用関数をもつ投資家は，どのような株式投資Xを考えても， \n\\begin{aligned}\n\\mathbb{E}[U(X)] = U(\\mathbb{E}[X])\n\\end{aligned}\n が成立します。 このような効用関数をもつ投資家をリスク中立的な投資家と呼びます。 リスク中立的な投資家は，確実なものと不確実なものの選好に関して無 差別となり，リスクプレミアムがゼロとなります。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>効用</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap04.html#確実性等価とリスク割引額",
    "href": "Hatakeda_Chap04.html#確実性等価とリスク割引額",
    "title": "4  効用",
    "section": "4.3 確実性等価とリスク割引額",
    "text": "4.3 確実性等価とリスク割引額\n次に，確実性等価について説明します。\n\n\n\n\n\n\n確実性等価\n\n\n\n確実性等価(certainty equivalent)とは，確率変数Xに対して， \n\\begin{aligned}\n\\mathbb{E}[U(X)] = U ( \\hat X)\n\\end{aligned}\n を満たす\\hat Xを確率変数Xの確実性等価(certainty equivalent)とよびます。\n\n\n\nつまり，効用の期待値が\\mathbb{E}[U(X)]であるとき，確実に得られる値\\hat Xの効用U ( \\hat X)が\\mathbb{E}[U(X)]と等しくなるような\\hat Xの値を確実性等価とよびます。 リスク回避的な投資家は，\n\n\\begin{aligned}\n\\mathbb{E}[U(X)] \\leq U(\\mathbb{E}[X]) \\Leftrightarrow CE \\leq \\mathbb{E}[X]\n\\end{aligned}\n\nと言い換えることができます。\n\n\n\n\n\n\n例6：株式Aのケース\n\n\n\n例1で登場した株式Aの期待効用は， \n\\begin{aligned}\n\\mathbb{E}[U(A)]  = 16250\n\\end{aligned}\n でした。 株式Aの期待値が確実に得られる証券Z_Aの効用は\n\n\\begin{aligned}\nU(Z_A)  = U(\\mathbb{E}[A]) = 16875\n\\end{aligned}\n\nとなります。 ここで，\\mathbb{E}[U(A)] = 16250の効用を得るためには，Z_A = \\hat Aをいくらに設定すればよいのかを考えてみましょう。 \n\\begin{aligned}\n\\mathbb{E}[U(A)] = 16250 &= U(\\hat A)\\\\\n16250 &= 300 \\hat A - \\hat A^2\\\\\n\\hat A & \\cong 70.94\n\\end{aligned}\n\n\n\n確実性等価の解釈として，不確実な値をとる資産を確実な値をとる資産で評価したときの値，というものがあります。 つまり，不確実な値をとる資産の売価(selling price)とも解釈できます。\n次に，リスク・ディスカウント額(risk discount)を考えてみましょう。\n\n\n\n\n\n\nリスク・ディスカウント\n\n\n\n確率変数Xの期待値\\mathbb{E}[X]と確実性等価\\hat Xの差を(RD)と呼ぶ。 \n\\begin{aligned}\nRD = \\mathbb{E}[X] - \\hat X\n\\end{aligned}\n\n\n\n\n\n\n\n\n\n例7\n\n\n\n例1の株式Aのリスク・ディスカウント額RD_Aは， \n\\begin{aligned}\nRD_A = 75 - 70.94 = 4.06\n\\end{aligned}\n となります。\n\n\n\n\n\n\n\n\n例8\n\n\n\n例1の株式Bのリスク・ディスカウント額RD_Bは， \n\\begin{aligned}\nRD_B = 80 - 69.38 = 10.62\n\\end{aligned}\n となります。\n\n\n次のこの株式Aと株式BからなるポートフォリオPを考えてみましょう。\n\n\n\n\n\n\n例9\n\n\n\n例1の株式Aを1/2単位，株式Bを1/2単位ずつ投資するとします。 この投資家の効用関数はU(X)=300X - X^2であるとします。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>効用</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap04.html#効用関数の曲率とリスク回避度",
    "href": "Hatakeda_Chap04.html#効用関数の曲率とリスク回避度",
    "title": "4  効用",
    "section": "4.4 効用関数の曲率とリスク回避度",
    "text": "4.4 効用関数の曲率とリスク回避度\n曲率が大きいほど，リスク回避度が高いといえます。 たとえば，投資家の効用関数をV(X) = 500 X - X^2とします。\nこのとき，株式Aと株式Bがもたらす期待効用は， \n\\begin{aligned}\n\\mathbb{E}[V(A)] &= \\frac 12 V(100) + \\frac 12 V(50)\\\\\n& = \\frac 12 \\times 40000 + \\frac 12 \\times 22500\\\\\n& = 31250\\\\\n\\mathbb{E}[V(B)] &= \\frac 12 V(120) + \\frac 12 V(40)\\\\\n& = \\frac 12 \\times 45600 + \\frac 12 \\times 18400\\\\\n& = 32000\n\\end{aligned}\n となり，この効用関数V()をもつ投資家は，\\mathbb{E}[V(A)]  &lt; \\mathbb{E}[V(B)]となり，株式Bを選択します。\nでは次に確実性等価を計算してみます。 確実性等価は，期待効用が\\mathbb{E}[V(A)]と等しくなるような確実な利益の量を計算します。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>効用</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html",
    "href": "Hatakeda_Chap05.html",
    "title": "5  ポートフォリオ理論",
    "section": "",
    "text": "5.1 投資のリターン\nこの章では，ファイナンスの主要分野の1つであるポートフォリオ理論(portfolio theory)について説明します。\nX_1は利子・配当などのインカムゲインと資産価格の上昇(下落)から生じるキャピタル・ゲイン(ロス)との合計額からなります。\nRで計算すると\nR = (117 - 90) / 90\nprint(R)\n\n[1] 0.3\n資金を資産1と資産2に分けて運用するポートフォリオを想定する。 企業を i , 時点を t で表し，投資時点を t=0 ，ペイオフが実現する時点を t=1 で表す。\nこのとき，各資産 i \\in \\{1,2\\} のリターンは，\nR_t \\equiv \\frac{X_{i,0}}{X_{i,1}} -1,% \\quad \\text{ for } i=1,2\nとなる。 ここで，以下の条件が成立していることに留意せよ。 \n\\begin{aligned}\nX_{1,0}  + X_{2,0} &= X_0\\\\\nX_{1,1}  + X_{2,1} &= X_1\n\\end{aligned}\nポートフォリオの投資収益率をR_pとすると，\n\\begin{aligned}\nR_p &\\equiv  \\frac{X_1}{X_0} -1 \\\\\n    &= \\frac{X_{1,1} + X_{2,1}}{X_0} -1\\\\\n    &= \\frac{X_{1,1}}{X_0} + \\frac{X_{2,1}}{X_0} -1 \\\\\n    &= \\frac{X_{1,0}}{X_0} \\times \\frac{X_{1,1}}{X_{1,0}} + \\frac{X_{2,0}}{X_0} \\times \\frac{X_{2,1}}{X_{2,0}} -1\n\\end{aligned}\nである。 ここで，\\omega _i \\equiv \\frac{X_{i,0}}{X_0} を資産 i への投資率，ただし \\omega _1 + \\omega_2 =  1 とすると，次式が求められる。\n\\begin{aligned}\nR_p &= \\omega _1 \\left ( \\frac{X_{1,1}}{X_{1,0}} -1 \\right )  + \\omega _2 \\left ( \\frac{X_{2,1}}{X_{2,0}} -1 \\right ) \\nonumber \\\\\n&= \\omega _1 R_1 + \\omega _2 R_2\n\\end{aligned}\n一般に，資金を資産1，資産2， \\cdots ，資産nに分けて運用するポートフォリオを想定する。 X_0 をポートフォリオへの投資額，資産 i \\in \\{1,\\dots , n \\} への投資金額を X_{i,0} とする。 また X_1 をポートフォリオからの総ペイオフ，X_{i,1} を資産 i \\in \\{1,\\dots , n \\} からのペイオフとする。 このとき，ポートフォリオの投資収益率は，\nR_p = \\sum_{i=1}^{n} \\omega _i R_i\nここで， \nR_i \\equiv \\frac{X_{i,1}}{X_{i,0}} - 1, \\qquad  \\omega _i \\equiv \\frac{X_{i,0}}{X_0} \\quad  \\text{ for } i=1,\\dots,n\n ただし\\sum \\omega _i = 1である。\n投資のポジションは次の2つに分けられる。\n\\omega _i を資産 i \\in \\{ 1,2\\} の投資率とするとき，ポートフォリオの期待リターンは， \n\\mathrm{E}[R_p ] \\equiv \\mu _p = \\omega _1 \\mu_1 + \\omega _2 \\mu _2\n となる。 ここで，\\mathrm{E}[R_i]=\\mu _i, \\omega _1 + \\omega _2 =1 となる。 \\omega_1 + \\omega _2 = 1より，以下のように書き直せる。\n\\mathrm{E}[R_p ] \\equiv \\mu _p = \\omega _1 \\mu_1 + (1-\\omega _1) \\mu _2\n投資比率\\omega_1とポートフォリオの期待収益率\\mu _pとの関係は次のように表される。\nこの図からわかるように，投資率とポートフォリオの期待リターンの間には線形関係が成立する。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html#投資のリターン",
    "href": "Hatakeda_Chap05.html#投資のリターン",
    "title": "5  ポートフォリオ理論",
    "section": "",
    "text": "リターンの定義\n\n\n\nt=0で金額X_0の投資を行い，t=1でX_1のペイオフを得るとき， \n\\begin{aligned}\nR \\equiv \\frac{X_1 - X_0}{X_0} = \\frac{X_1}{X_0} -1\n\\end{aligned}\n\nを投資収益率(リターン)とよびます。\n\n\n\n\n\n\n\n\n\n例1:リターン\n\n\n\n90万円の資産を購入し，1年後117万円で売却できるなら，その投資収益率はいくらか？ \nR = \\frac{117-90}{90} = \\frac{117}{90}-1 =0.3\n\n\n\n\n\n\n\n\n\n\n\n例2 : 株式\n\n\n\nX_{t-1} は時点 t-1 の株価 P_{t-1} ， X_t はその株式が時点 t でもたらすペイオフとなる。 ここで，時点tでもたらすペイオフとは，株式を保有することで得られる配当D_tと時点tにおける株式の価値(配当落ち株価P_t)の合計となる。 したがって，時点t-1から時点tにかけて実現した株式の投資リターンR_tは， \nR_t \\equiv \\frac{X_t}{X_{t-1}} - 1 = \\frac{D_t + P_t}{P_{t-1}} -1\n\\tag{5.1} ここでDは一株当りの配当で，Pは一株当りの株価である。\n日時リターンを(Equation 5.1) 式に従って計算する場合は，年間配当額 D_{i,t} を365で割ることで日次配当を計算することになるが，ほとんどの場合無視できるほど小さいので，株式iの日時リターンR_{i,t}は， \nR_{i,t} = \\frac{P_{i,t}}{P_{i,t-1}} - 1\n\nで計算される。\n\n\n\n\nX_0：ポートフォリオへの投資額\nX_{i,0}：各資産i，i = 1,2への投資金額\nX_1：ポートフォリオから総ペイオフ\nX_{i,1}：資産iからのペイオフ\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\omega _i &gt;0：資産に対して買いポジション(ロングポジション)\n\\omega _i &lt;0：資産に対して空売り(ショートポジション)\n\n\n\n\n\n\n\n例3\n\n\n\n資産10億円をもつ投資家が，資産1に8億円，資産2に2億円投資する場合， \n\\omega _1 = 0.8, \\quad \\omega _2 = 0.2\n\n\n\n\n\n\n\n\n\n例4\n\n\n\n資金10億円をもつ投資家が，資産2を2億円相当分空売り，空売りで入手した資金を自己資金を12億円を，資産1に投資する場合 \n\\omega _1 = 1.2, \\quad  \\omega _2 = -0.2\n\n\n\n\n\n\n\n\n\n\n\n例5\n\n\n\n各資産の投資率(\\omega _1, \\omega_2) = (0.4,0.6)，各資産の期待リターン(\\mu_1, \\mu_2)=(0.12,0.06)のとき， ポートフォリオの期待リターンは， \n\\mu _p = 0.4 \\times 0.12 + 0.6 \\times 0.06 = 0.084",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html#ポートフォリオのリスク",
    "href": "Hatakeda_Chap05.html#ポートフォリオのリスク",
    "title": "5  ポートフォリオ理論",
    "section": "5.2 ポートフォリオのリスク",
    "text": "5.2 ポートフォリオのリスク\n資産1がもたらすリターンの分散を \\sigma^2 _1 ，資産2のリターンの分散を \\sigma^2 _2 ，資産1と資産2の収益の共分散を \\sigma _{12} とする。 このときポートフォリオのリターンの分散は， \n\\mathrm{Var} [R_p] \\equiv \\sigma ^2_p = \\omega _1^2 \\sigma ^2_1 + \\omega_2^2 \\sigma ^2_2 + 2 \\omega _1 \\omega_2 \\sigma _{12}\n\\tag{5.2}\nとなる(第2回講義資料の(23)式と(25)式を参照)。\n相関係数を \\rho で表すとき，(Equation 5.2) 式は， \n\\mathrm{Var} [R_p] \\equiv \\sigma ^2_p = \\omega _1^2 \\sigma ^2_1 + \\omega_2^2 \\sigma ^2_2 + 2 \\omega _1 \\omega_2  \\textcolor{red}{\\rho \\sigma _1 \\sigma _2}\n\\tag{5.3}\nここで相関係数 \\rho の定義は次式となる。\n\n\\rho = \\frac{\\sigma _{12}}{\\sigma ^1 \\sigma ^2} \\Longleftrightarrow  \\sigma _{12} = \\rho \\sigma _1 \\sigma _2\n\n\n\n\n\n\n\n例6\n\n\n\n各資産の投資率が(\\omega _1, \\omega _2) =(0.4, 0.6)，各資産のリターンの分散が(\\sigma^2_1, \\sigma ^2_2) =(0.18^2, 0.12^2)，相関係数\\rho =0のとき，ポートフォリオのリターンの分散は，()式より， \n\\begin{aligned}\n\\sigma ^2_p &= 0.4^2 \\times 0.18^2 + 0.6^2 \\times 0.12^2 + 2 \\times 0.4 \\times 0.6 \\times 0 \\times 0.18 \\times 0.12\\\\\n            &= 0.010368 \\nonumber \\\\\n\\sigma _p   &= \\sqrt{0.010368} = 0.102 \\nonumber\n\\end{aligned}\n\n\n\n一般に，n 種ある資産 i \\in \\{1,2,\\dots , n\\} への各投資割合を \\omega _i で表し，投資割合の合計が1，つまり \\sum \\omega _1 =1 の投資率とするとき，\n\nポートフォリオの期待リターン：\\mu _p \n  \\mathrm{E} [R_p] \\equiv \\mu _p = \\sum _{i=1}^n \\omega _i \\mu _i \\tag{14-1}\n  \nここで，\\mathrm{E}[R_i] = \\mu _i\nポートフォリオのリターンの分散：\\sigma ^2_p \n  \\mathrm{V}[R_p] \\equiv \\sigma ^2_p =\\sum _{i=1}^n \\omega _i^2 \\sigma ^2_i + 2\\sum _{i \\not = j}^n \\sum _{j\\not = i}^n \\omega _i \\omega _j \\sigma _{i,j} \\tag{14-2}\n   ここで，\\mathrm{V}[R_i] = \\sigma^2_i , \\mathrm{Cov}[R_i,R_j] \\equiv \\sigma_{i,j} for i \\not = j\n\n(14-2)式に関しては，第2回の講義資料(23)式と(25)式を参照\n投資率\\omega _1とポートフォリオのリターンの標準偏差\\sigma _pの関係\n\n\n\n\n\n\n\n\n\n\nリスク低減効果の源泉について考える。\n\n\\begin{aligned}\n\\sigma _p^2 &= \\omega _1^2 \\sigma ^2_1 + \\omega_2^2 \\sigma ^2_2 + 2 \\omega _1 \\omega _2 \\rho \\sigma _1 \\sigma_2\\\\\n            &= (\\omega _1 \\sigma_ 1 + \\omega _2 \\sigma _2)^2  -2 (1-\\rho )\\omega _1 \\omega _2 \\sigma _1 \\sigma _2\n\\end{aligned}\n\n\\omega _1 と \\omega _2 が非負ならば， (1-\\rho)\\omega _1 \\omega _2 \\sigma _1 \\sigma _2 も非負 \n\\sigma _p \\geq \\omega _1 \\sigma _1 + \\omega _2 \\sigma _2\n\nポートフォリオの総リスクは，個別資産の総リスクの加重和以下になる。 \\rho = 1 でない限り，厳密な不等号が成立する。\n\\rho = 1 のとき， \n\\begin{aligned}\n\\sigma _p^2 &= \\omega _1^2 \\sigma ^2_1 + \\omega_2^2 \\sigma ^2_2 + 2 \\omega _1 \\omega _2 \\rho \\sigma _1 \\sigma_2 = (\\omega _1 \\sigma_1 + \\omega _2 \\sigma _2)^2\\\\\n\\sigma _p &= \\omega _1 \\sigma_ 1 + \\omega _2 \\sigma _2\n\\end{aligned}\n\nリスク分散効果への相関係数のインパクトについて見ていく。 リスク分散の効果は，\\rho の大きさに依存している。\n\n\\begin{tikzpicture}[domain=0:1,yscale = 20, xscale=10]%, samples=100, very thick] % 定義域、点の数、線幅\n% \\draw (0,0) node[below left]{O}; % 原点、0でも、above, below, left, rightで位置指定\n % 位置指定はanchor=north, south, east, westでも可能\n\\draw[thick, -&gt;] (-0.02,0) -- (1.1,0) node[right] {$\\omega _1$}; % x軸、[-&gt;]で矢印、他に[-stealth]等\n\\draw[thick, -&gt;] (0,-0.01) -- (0,0.20) node[above] {$\\sigma _p$}; % y軸\n\\foreach \\x in {0.10,0.20,0.30,0.40,0.50,0.60,0.70,0.80,0.90,1.00} {\n    \\draw (\\x,0) -- (\\x, -0.01);\n    \\draw (\\x,-.01) node[below]{$\\x$};\n    }\n\\foreach \\y in {0.02,0.04,0.06,0.08,0.10,0.12,0.14,0.16,0.18} {\n    \\draw (0,\\y) -- (-0.01,\\y);\n    \\draw (0,\\y) node[left]{$\\y$};\n}\n\n\\draw [magenta,thick] plot(\\x, { sqrt(\\x^2*0.18^2 + (1-\\x)^2*0.12^2) });% rho =0\n\\draw [cyan,thick] plot(\\x, { \\x *0.18 + (1-\\x)*0.12 });% rho=1\n% \\draw [orange,thick] plot(\\x, { sqrt( \\x^2 * 0.18^2 + ( 1 - \\x)^2 * 0.12^2 - 2*\\x*(1-\\x)*0.18*0.12) });% rho=1\n\\draw [orange,thick] plot(\\x, { sqrt(0.014400000 - 0.072000000*\\x + 0.0900000000*\\x^2)});% rho=1\n\n% \\draw [magenta,thick] plot(\\x, { sqrt(\\x^2*0.18^2 + (1-\\x)^2*0.12^2) });% node at(5.5,2) {$\\mu _p = \\omega_1 \\times  0.12 + (1-\\omega _1 )\\times 0.06$}; % atでnodeの位置指定\n% \\draw (0,0.6) node[left]{$0.06$};\n% \\draw (5.5,1) node {$\\phantom{\\mu _p }= \\omega_1 0.06 + 0.06$}; % atでnodeの位置指定\n\\end{tikzpicture}",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html#資産の最適化問題の解法",
    "href": "Hatakeda_Chap05.html#資産の最適化問題の解法",
    "title": "5  ポートフォリオ理論",
    "section": "5.3 2資産の最適化問題の解法",
    "text": "5.3 2資産の最適化問題の解法\n株式と安全資産の2資産を考える。\n\nR_s: 株式リターン \\mathrm{E}[R_s]=\\mu_s, \\quad \\mathrm{V}[R_s] = \\sigma ^2_s\nr_f: 安全資産リターン \\mathrm{E}[r_f]=r_f, \\quad \\mathrm{V}[r_f] = 0\nR_p: ポートフォリオの期待リターン \\mathrm{E}[R_p]=\\mu_p, \\quad \\mathrm{V}[R_p] = \\sigma ^2_p\n\n次のような投資家の期待効用関数を仮定する。 \n\\mathrm{E}[U] = \\mu _p - \\frac 12 \\gamma \\sigma _p^2, \\quad \\gamma \\text{は絶対的リスク回避度}\n\\tag{5.4}\n\nポートフォリオの期待リターンが上昇するほど期待効用は上昇\nポートフォリオの分散(標準偏差)が小さいほど期待効用は上昇\n\n投資家は，できる限り高い期待リターンと標準偏差の低いポートフォリオを選択しようとする。\n2資産の最適化問題の解法について見てみる。\n投資率(\\omega _1, \\omega_ 2)とするとき，\n\nポートフォリオの期待リターン \n  \\mathrm{E}[R_p] = \\omega _1 \\mu_s + \\omega _2 r_f\n   \\tag{5.5}\nポートフォリオの期待リターンの分散 \n  \\mathrm{V}[R_p] = \\omega _1^2 \\sigma ^2_s\n   \\tag{5.6}\n\n\n式と (Equation 5.6) 式を (Equation 5.4) 式に代入\n\n\n\\mathrm{E}[U] = \\mu _p - \\frac{\\gamma }{2} \\sigma ^2_p = \\omega _1 \\mu_s + \\omega _2 r_f - \\frac{\\gamma }{2}\\omega ^2_1 \\sigma ^2_s\n\n\\omega _1 + \\omega _2 = 1 より，投資家の期待効用関数は，\n\n\\mathrm{E}[U] = \\omega _1 ( \\mu_s - r_f) -\\frac{\\gamma }{2} \\omega _1^2 \\sigma ^2_s + r_f\n\\tag{5.7}\n期待効用(Equation 5.7) 式を最大にする最適なポートフォリオとなる株式への投資率(\\omega _1)を求める。\n\n%f(\\omega _1) \\equiv\n\\mathrm{E}[U] = \\omega _1 ( \\mu_s - r_f) - \\frac{\\gamma }{2}\\omega _1^2 \\sigma^2_s + r_f\n\nと置くと，f(\\omega _1)は\\omega _1に関する上に凸の2次関数である。\n\\omega _1について，最適化の1階の条件を求め，最適\\omega _1^*を計算する。 \n\\begin{aligned}\n%f'(\\omega _1)\n\\frac{\\partial \\mathrm{E}[U]}{\\partial \\omega _1} &= \\mu_s -r_f - \\gamma \\omega _1 \\sigma ^2_s =0 \\\\\n\\omega _1^* &= \\frac{1}{\\gamma } \\frac{\\mu_s - r_f}{\\sigma ^2_s}, \\quad \\mu_s - r_f \\text{はリスクプレミアム}\n\\end{aligned}\n 求めた株式への最適投資率\\omega^* _1について比較静学を行い，最適解の挙動を確認する。\nまず，リスクプレミアムと投資率の関係は， \n\\begin{aligned}\n\\frac{\\partial \\omega _1^*}{\\partial (\\mu_s - r_f)} = \\frac{1}{\\gamma }\\frac{1}{\\sigma _s^2} &gt; 0\n\\end{aligned}\n となり，リスクプレミアムと投資率の間には正の関係がある。 次に，株式のリスクと投資率の関係は， \n\\frac{\\partial \\omega _1^*}{\\partial \\sigma ^2_s} = -2 \\frac{1}{\\gamma }\\frac{\\mu_s -r_f }{\\sigma _s^4} &lt; 0\n となり，リスクと投資率の間には負の関係がある。 最後に，リスク回避度と投資率の関係は， \n\\frac{\\partial \\omega _1^*}{\\partial \\gamma} = - \\frac{1}{\\gamma^2 }\\frac{\\mu_s -r_f }{\\sigma _s^2} &lt; 0\n となり，リスク回避度と投資率の間には負の関係がある。\nまとめると，リスクプレミアム\\mu_s-r_fが上昇，株式のリスク\\sigma_s^2が減少，リスク回避度 \\gamma が減少するとき，株式への投資割合 \\omega _1 が増える。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html#投資可能集合と効率的フロンティア",
    "href": "Hatakeda_Chap05.html#投資可能集合と効率的フロンティア",
    "title": "5  ポートフォリオ理論",
    "section": "5.4 投資可能集合と効率的フロンティア",
    "text": "5.4 投資可能集合と効率的フロンティア\nリスク資産のみからなる投資対象があるとする。 例6のケース(ただし,相関係数 \\rho =0 ， \\omega _1 の値は任意)では，\n\n\\mu _p = \\omega _1 \\times 0.12 + (1-\\omega _1)\\times 0.06 = 0.06(1+\\omega _1)\n\\tag{5.8}\n\n\\begin{aligned}\n\\sigma_s^2 &= \\omega _1^2 \\times 0.18^2 +(1-\\omega _1)^2 \\times 0.12^2 + 2 \\omega _1(1-\\omega _1) \\times 0 \\times 0.18 \\times 0.12 \\nonumber \\\\\n           &=(0.18^2 + 0.12^2)\\omega _1^2 - 2 \\times 0.12 ^2 \\omega _1 + 0.12^2\n\\end{aligned}\n\\tag{5.9}\n\n式を \\omega _1 に関して解いて(Equation 5.9) 式に代入する。\n\n(\\mu _p , \\sigma _p) の関係は双曲線である。 後で見るように，相関係数の大きさに依存して双曲線の形状は変化する。 以下で投資可能領域を図示する。\n\n\nCode\n# text p.65\n# 設定\nrho = 0\n\nsigma_A &lt;- 0.18  # 資産Aの標準偏差\nsigma_B &lt;- 0.12  # 資産Bの標準偏差\nmu_A &lt;- 0.12     # 資産Aの期待リターン\nmu_B &lt;- 0.06     # 資産Bの期待リターン\n\n# 保有費率\nwa &lt;- seq(0,1,by = 0.01)\nwb &lt;- 1 - wa\n\ndf &lt;- tibble(\n  mu_p = wa * mu_A + wb * mu_B,\n  sigma_p = sqrt(wa^2 * sigma_A^2 + wb^2 * sigma_B^2 + 2 * rho * wa * wb * sigma_A * sigma_B),\n  label= c(\n  \"0,1\", rep(\"\", 9),\n  \"0.1,0.9\",rep(\"\", 9),\n  \"0.2,0.8\",rep(\"\", 9),\n  \"0.3,0.7\",rep(\"\", 9),\n  \"0.4,0.6\",rep(\"\", 9),\n  \"0.5,0.5\",rep(\"\", 9),\n  \"0.6,0.4\",rep(\"\", 9),\n  \"0.7,0.3\",rep(\"\", 9),\n  \"0.8,0.2\",rep(\"\", 9),\n  \"0.9,0.1\",rep(\"\", 9),\n  \"1,0\")\n  )\n\ng &lt;- ggplot(df) + aes(y = sigma_p, x = mu_p) + geom_line() + geom_point(data = filter(df, label != \"\"), aes(label = label), size = 2) + coord_flip() + ylim(0, 0.2) + xlim(0, 0.14) +\n  labs(title = \"投資可能領域のプロット\", x = \"期待リターン\", y = \"リスク（標準偏差）\") + theme_classic(base_family = \"HiraKakuPro-W3\") # Add labels for clarity\n# 資産Aと資産Bの文字を追加し，hiragino Kaku Gothic ProNはMacの場合のフォント指定\ng &lt;- g +\n  geom_text(aes(label = \"資産A\"), x = 0.12, y = 0.19, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(aes(label = \"資産B\"), x = 0.06, y = 0.13, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(aes(label = \"無相関のケース\"), x = 0.09, y = 0.16, size = 4, family = \"HiraKakuPro-W3\") # Specify the font family for consistency\nprint(g)\n\n\n\n\n\n\n\n\n\n\n曲線上の点が投資可能領域(ポートフォリオは実現リターンと標準偏差の組み合わせとなる)。\n2つのリスク資産のリターンの相関係数がリスク低減効果に与える影響を図示すると，次のようになる。 相関係数がマイナス1に近づくほど，左に弓なりになる。つまり**ポートフォリオのリスク低減効果が高いことを意味する。\n\n\nCode\n# 相関係数のリスト\nrho_values &lt;- c(-1, 0, 1)\n\n# 資産の標準偏差と期待リターン\nsigma_A &lt;- 0.18  # 資産Aの標準偏差\nsigma_B &lt;- 0.12  # 資産Bの標準偏差\nmu_A &lt;- 0.12     # 資産Aの期待リターン\nmu_B &lt;- 0.06     # 資産Bの期待リターン\n\n# 保有比率\nwa &lt;- seq(0, 1, by = 0.1)\nwb &lt;- 1 - wa\n\n# データフレーム作成\ndf &lt;- expand.grid(wa = wa, rho = rho_values) |&gt;\n  mutate(\n    wb = 1 - wa,\n    mu_p = wa * mu_A + wb * mu_B,\n    sigma_p = sqrt(wa^2 * sigma_A^2 + wb^2 * sigma_B^2 + 2 * rho * wa * wb * sigma_A * sigma_B),\n    rho_label = factor(rho, levels = c(-1, 0, 1), labels = c(\"相関 = -1\", \"相関 = 0\", \"相関 = 1\"))\n  )\n\n# waが0.1刻みのデータを抽出\nlabel_points &lt;- df |&gt;\n  filter(wa %in% seq(0, 1, by = 0.1))\n\n# プロット\ng &lt;- ggplot(df, aes(x = mu_p, y = sigma_p, color = rho_label)) +\n  geom_line(size = 1) +\n  geom_point(data = label_points, aes(x = mu_p, y = sigma_p, color = rho_label), size = 2) +  # 凡例と色を統一\n  coord_flip() +\n  scale_y_continuous(limits = c(0, 0.21), expand = c(0, 0)) +  # 0以下の余白を削除\n  scale_x_continuous(limits = c(0, 0.15), expand = c(0, 0)) + # x軸の余白も削除\n  labs(\n    title = \"投資可能領域のプロット（相関の影響）\",\n    x = \"期待リターン\",\n    y = \"リスク（標準偏差）\",\n    color = \"相関係数\"\n  ) +\n  theme_classic(base_family = \"HiraKakuPro-W3\") +\n  theme(legend.position = \"bottom\")  # 凡例を下に配置\n\n# 資産Aと資産B、無相関ケースのラベル追加\n# g &lt;- g +\n#   geom_text(label = \"資産A\", x = 0.12, y = 0.19, size = 4, family = \"HiraKakuPro-W3\") +\n#   geom_text(label = \"資産B\", x = 0.06, y = 0.13, size = 4, family = \"HiraKakuPro-W3\") +\n#   geom_text(label = \"無相関のケース\", x = 0.09, y = 0.19, size = 4, family = \"HiraKakuPro-W3\")\n\n# 描画\nprint(g)\n\n\n\n\n\n\n\n\n\n3つのリスク資産のみのケースを考える。 リスク資産が増えれば増えるほど，左に弓なりになる。 つまりポートフォリオのリスク低減効果が大きくなる。\n\n\nCode\nrho &lt;- 0  # 相関係数（仮にすべての組み合わせで無相関とする）\n\n# 資産の標準偏差と期待リターン\nsigma_A &lt;- 0.18  # 資産Aの標準偏差\nsigma_B &lt;- 0.12  # 資産Bの標準偏差\nsigma_C &lt;- 0.07  # 資産Cの標準偏差\n\nmu_A &lt;- 0.12     # 資産Aの期待リターン\nmu_B &lt;- 0.06     # 資産Bの期待リターン\nmu_C &lt;- 0.04     # 資産Cの期待リターン\n\n# 保有比率（wa, wb の組み合わせを作成し、wc = 1 - wa - wb を計算）\nwa_wb_grid &lt;- expand.grid(wa = seq(0, 1, by = 0.05), wb = seq(0, 1, by = 0.05)) |&gt;\n  mutate(wc = 1 - wa - wb) |&gt;\n  filter(wc &gt;= 0)  # wcが負にならないように制限\n\n# 3資産ポートフォリオの計算\ndf &lt;- wa_wb_grid |&gt;\n  mutate(\n    mu_p = wa * mu_A + wb * mu_B + wc * mu_C,\n    sigma_p = sqrt(\n      wa^2 * sigma_A^2 + wb^2 * sigma_B^2 + wc^2 * sigma_C^2 +\n      2 * rho * (wa * wb * sigma_A * sigma_B + wb * wc * sigma_B * sigma_C + wc * wa * sigma_C * sigma_A)\n    )\n  )\n\n# プロット\ng &lt;- ggplot(df, aes(x = mu_p, y = sigma_p)) +\n  geom_point(alpha = 0.3, color = \"blue\") +  # 3資産の投資可能領域を点でプロット\n  coord_flip() +\n  scale_y_continuous(limits = c(0, 0.21), expand = c(0, 0)) +  # 0以下の余白を削除\n  scale_x_continuous(limits = c(0, 0.15), expand = c(0, 0)) + # x軸の余白も削除\n  labs(\n    title = \"投資可能領域のプロット（資産A, B, C）\",\n    x = \"期待リターン\",\n    y = \"リスク（標準偏差）\"\n  ) +\n  theme_classic(base_family = \"HiraKakuPro-W3\") +\n  theme(legend.position = \"none\")  # 凡例を非表示（点のプロットのため）\n\n# 資産A, B, Cのラベル追加\ng &lt;- g +\n  geom_text(label = \"資産A\", x = 0.12, y = 0.19, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(label = \"資産B\", x = 0.06, y = 0.13, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(label = \"資産C\", x = 0.04, y = 0.08, size = 4, family = \"HiraKakuPro-W3\")\n\n# 描画\nprint(g)\n\n\n\n\n\n\n\n\n\n3つのリスク資産への投資可能領域は，曲線上ではなく曲線に囲まれた領域(集合)となる。ただこのうち，同じリスク(同じ標準偏差)の下で最も高い期待リターンを実現するポートフォリオが最適となるため，双曲線の上半分が望ましいポートフォリオとなり，これを効率的フロンティアと呼ぶ。\n\n\nCode\nrho &lt;- 0  # 相関係数（仮にすべての組み合わせで無相関とする）\n\n# 資産の標準偏差と期待リターン\nsigma_A &lt;- 0.18  # 資産Aの標準偏差\nsigma_B &lt;- 0.12  # 資産Bの標準偏差\nsigma_C &lt;- 0.07  # 資産Cの標準偏差\n\nmu_A &lt;- 0.12     # 資産Aの期待リターン\nmu_B &lt;- 0.06     # 資産Bの期待リターン\nmu_C &lt;- 0.04     # 資産Cの期待リターン\n\n# 保有比率（wa, wb の組み合わせを作成し、wc = 1 - wa - wb を計算）\nwa_wb_grid &lt;- expand.grid(wa = seq(0, 1, by = 0.01), wb = seq(0, 1, by = 0.01)) |&gt;\n  mutate(wc = 1 - wa - wb) |&gt;\n  filter(wc &gt;= 0)  # wcが負にならないように制限\n\n# 3資産ポートフォリオの計算\ndf &lt;- wa_wb_grid |&gt;\n  mutate(\n    mu_p = wa * mu_A + wb * mu_B + wc * mu_C,\n    sigma_p = sqrt(\n      wa^2 * sigma_A^2 + wb^2 * sigma_B^2 + wc^2 * sigma_C^2 +\n      2 * rho * (wa * wb * sigma_A * sigma_B + wb * wc * sigma_B * sigma_C + wc * wa * sigma_C * sigma_A)\n    )\n  )\n\n# 効率的フロンティアを特定（sigma_p が同じなら mu_p が最大のものを選択）\n\n# プロット\ng &lt;- ggplot(df, aes(x = mu_p, y = sigma_p)) +\n  geom_point(alpha = 0.1, color = \"blue\") +  # 3資産の投資可能領域を点でプロット\n  # geom_point(data = efficient_frontier, aes(x = mu_p, y = sigma_p), color = \"red\", size = 2) +  # 効率的フロンティアの点を赤色で表示\n  coord_flip() +\n  scale_y_continuous(limits = c(0, 0.21), expand = c(0, 0)) +  # 0以下の余白を削除\n  scale_x_continuous(limits = c(0, 0.15), expand = c(0, 0)) + # x軸の余白も削除\n  labs(\n    title = \"投資可能領域と効率的フロンティア（資産A, B, C）\",\n    x = \"期待リターン\",\n    y = \"リスク（標準偏差）\"\n  ) +\n  theme_classic(base_family = \"HiraKakuPro-W3\") +\n  theme(legend.position = \"none\")  # 凡例を非表示（点のプロットのため）\n\ng &lt;- g +\n  geom_text(label = \"資産A\", x = 0.12, y = 0.19, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(label = \"資産B\", x = 0.06, y = 0.13, size = 4, family = \"HiraKakuPro-W3\") +\n  geom_text(label = \"資産C\", x = 0.04, y = 0.08, size = 4, family = \"HiraKakuPro-W3\")\n\n# 描画\nprint(g)\n\n\n\n\n\n\n\n\n\n\n# 変数の定義\nrho &lt;- 0  # 無相関\nsigma_A &lt;- 0.18\nsigma_B &lt;- 0.12\nsigma_C &lt;- 0.07\n\nmu_A &lt;- 0.12\nmu_B &lt;- 0.06\nmu_C &lt;- 0.04\n\n# 共分散行列の作成（対角行列）\ncov_matrix &lt;- matrix(c(sigma_A^2, 0, 0,\n                       0, sigma_B^2, 0,\n                       0, 0, sigma_C^2),\n                     nrow = 3, byrow = TRUE)\n\n# ポートフォリオの生成\nset.seed(123)\nn_portfolios &lt;- 5000\nweights &lt;- matrix(runif(3 * n_portfolios), ncol = 3)\nweights &lt;- weights / rowSums(weights)  # 各行の合計を1にする\n\n# 期待リターンとリスクを計算\nport_returns &lt;- weights %*% c(mu_A, mu_B, mu_C)\nport_risks &lt;- sqrt(rowSums((weights %*% cov_matrix) * weights))\n\n# データフレームに格納\nportfolio_data &lt;- tibble(Return = port_returns, Risk = port_risks)\n\n# 効率的フロンティアのプロット\nggplot(portfolio_data, aes(x = Risk, y = Return)) +\n  geom_point(alpha = 0.5, color = \"blue\") +\n  labs(title = \"Efficient Frontier\",\n       x = \"Risk (Standard Deviation)\",\n       y = \"Expected Return\") +\n  scale_x_continuous(limits = c(0, 0.21), expand = c(0, 0)) +  # 0以下の余白を削除\n  scale_y_continuous(limits = c(0, 0.15), expand = c(0, 0)) + # x軸の余白も削除\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n5.4.1 複数資産のケース：安全資産も含む\n安全資産(リターン r_f )と1つのリスク資産(期待リターン \\mu _1 ,その分散 \\sigma ^2_1 )か らなるポートフォリオの期待リターン \\mu _p は， \n\\mu _p = \\omega _1 \\mu _1 + (1 - \\omega _1)r_f = (\\mu _1 - r_f)\\omega _1 + r_f\n\\tag{5.10}\nとなり，その分散 \\sigma ^2_p は,\n\n\\begin{aligned}\n\\sigma ^2_p &= \\mathrm{E}\\left[ (R_p - \\mu _p)^2 \\right ]\\\\\n            &= \\mathrm{E}\\left[ \\left ( \\omega _1 R_1 + (1-\\omega _1)r_f - (\\omega _1 \\mu_1 + (1-\\omega _1)r_f) \\right ) ^2 \\right ] \\nonumber \\\\\n            &= \\mathrm{E}\\left[ \\left (\\omega_1 ( R_1 - \\mu _1) \\right ) ^2 \\right ]\\nonumber \\\\\n            &= \\omega _1 ^2 \\mathrm{E} \\left [ (R_1 - \\mu _1)^2 \\right ] \\nonumber\\\\\n            &=\\omega _1^2 \\sigma_1^2 \\nonumber\n\\end{aligned}\n\\tag{5.11}\nとなる。 つぎに，(Equation 5.11 ) 式を変形する。 \\sigma_1&gt;0 かつ \\omega_1 &gt;0 であるため，\\sigma _p = \\omega _1 \\sigma _1 となり，これより \\omega_1 = \\sigma _p / \\sigma_1 と変形できる。この \\omega_1 を(Equation 5.10 ) 式に代入し整理する。\n\n\\begin{aligned}\n\\mu_p &= (\\mu_1 - r_f) \\omega _1 + r_f \\\\\n      &= (\\mu_1 - r_f) \\frac{\\sigma_p}{\\sigma_1} + r_f \\\\\n      &= \\left ( \\frac{\\mu _1- r_f}{\\sigma_1} \\right ) \\sigma _p +r_f\n\\end{aligned}\n となり，ポートフォリオの期待リターン \\mu _p は，無リスク利子率 r_f を切片，傾きを \\frac{\\mu _1 - r_f}{\\sigma _1} とする \\sigma_p の線形関数となる。\n以下のように，w_A \\sigma _A = w_B \\sigma_Bとなるようにw_Aとw_Bを選べば、\\sigma _P = 0となるポートフォリオを作れる。\n\n# text p.65\nsigma_A &lt;- 0.18  # 資産Aの標準偏差\nsigma_B &lt;- 0.12  # 資産Bの標準偏差\nmu_A &lt;- 0.12     # 資産Aの期待リターン\nmu_B &lt;- 0.06     # 資産Bの期待リターン\n\nwa &lt;- seq(0,1,by = 0.01)\nwb &lt;- 1 - wa\n\n\ndf &lt;- tibble(\n  mu_p = wa * mu_A + wb*mu_B,\n  sigma_p = abs(wa*sigma_A - wb*sigma_B),\n  label= c(\n  \"0,1\", rep(\"\", 9),\n  \"0.1,0.9\",rep(\"\", 9),\n  \"0.2,0.8\",rep(\"\", 9),\n  \"0.3,0.7\",rep(\"\", 9),\n  \"0.4,0.6\",rep(\"\", 9),\n  \"0.5,0.5\",rep(\"\", 9),\n  \"0.6,0.4\",rep(\"\", 9),\n  \"0.7,0.3\",rep(\"\", 9),\n  \"0.8,0.2\",rep(\"\", 9),\n  \"0.9,0.1\",rep(\"\", 9),\n  \"1,0\")\n)\nggplot(df) + aes(y = sigma_p, x = mu_p) + geom_line() + geom_point(data = filter(df, label != \"\"), aes(label = label), size = 2) + coord_flip()",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap06.html",
    "href": "Hatakeda_Chap06.html",
    "title": "6  CAPM",
    "section": "",
    "text": "6.1 CAPM第1定理\n資本資産価格モデル(Capital Asset Pricing Model)\n「接点ポートフォリオ＝マーケット・ポートフォリオ」\n\\Rightarrow マーケット・ポートフォリオは効率的なポートフォリオ",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>CAPM</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap06.html#capm第1定理",
    "href": "Hatakeda_Chap06.html#capm第1定理",
    "title": "6  CAPM",
    "section": "",
    "text": "マーケット・ポートフォリオ： 市場に供給されるすべての証券からなるポートフォリオ。 マーケット・ポートフォリオにおける各証券の供給額の比率は，全ての証券の時価総額： M = \\sum _i X_i (ここで，X_i は第 i 証券の時価総額)に対する各証券の時価総額：X_i ，すなわち， w_i = \\frac{X_i}{M} となる。\n分離定理のもとで，投資家は安全資産と接点ポートフォリオの組み合わせによって最適なポートフォリオを選択する。このとき，効率的なポートフォリオである接点ポートフォリオは，すべての投資家で同一。\n市場が均衡する状態(需要と供給が一致する)では，\n\n\n\n\nマーケット・ポートフォリオとして，実際にはTOPIXが用いられる。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>CAPM</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap06.html#資本市場線",
    "href": "Hatakeda_Chap06.html#資本市場線",
    "title": "6  CAPM",
    "section": "6.2 資本市場線",
    "text": "6.2 資本市場線\n\n効率的フロンティア上にあるポートフォリオの期待収益率のリスク(標準偏差)との関係を資本市場線(capital market line: CML)と呼ぶ。 資本市場線は， \nu_p = r_f + \\underbrace{\\frac{\\mu_M - r_f}{\\sigma_m}}_{\\rlap{マーケット\\\\リスクの価格}} \\times \\sigma_p\n\n\nで与えられる。1\nここで，\\mu_M ： マーケット・ポートフォリオの期待リターン，\\sigma _M : その標準偏差",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>CAPM</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap06.html#ベータ",
    "href": "Hatakeda_Chap06.html#ベータ",
    "title": "6  CAPM",
    "section": "6.3 ベータ",
    "text": "6.3 ベータ\nR_i : 証券 i のリターン，R_M : マーケット・ポートフォリオのリターンとするとき，証券 i のベータとは次の式で定義される。\n\n\\beta _i = \\frac{\\sigma _{i,M}}{\\sigma _M^2} = \\rho \\frac{\\sigma_i}{\\sigma _M}\n\n同様に，ポートフォリオ P のベータは\n\n\\beta_p \\equiv \\frac{\\sigma_{p,M}}{\\sigma_M^2} = \\rho \\frac{\\sigma_p}{\\sigma_M}\n\nベータはパラメータ！",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>CAPM</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap06.html#footnotes",
    "href": "Hatakeda_Chap06.html#footnotes",
    "title": "6  CAPM",
    "section": "",
    "text": "V.の(27)式を参照↩︎",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>CAPM</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap07.html",
    "href": "Hatakeda_Chap07.html",
    "title": "7  裁定価格",
    "section": "",
    "text": "裁定価格(Arbitrage Pricing)",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>裁定価格</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap08.html",
    "href": "Hatakeda_Chap08.html",
    "title": "8  市場の効率性",
    "section": "",
    "text": "市場の効率性(market efficiency)",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>市場の効率性</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap09.html",
    "href": "Hatakeda_Chap09.html",
    "title": "9  行動ファイナンス",
    "section": "",
    "text": "行動ファイナンス(behavioral finance theory)",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>行動ファイナンス</span>"
    ]
  },
  {
    "objectID": "Hatakeda_Chap05.html#基金分離定理",
    "href": "Hatakeda_Chap05.html#基金分離定理",
    "title": "5  ポートフォリオ理論",
    "section": "5.5 6． 2基金分離定理",
    "text": "5.5 6． 2基金分離定理\n効率的フロンティアにおける特徴として，リスク回避的な投資家であるならば，効率的フロンティア上のポートフォリオを選択しようとする。 また，安全資産と多数のリスク資産に投資する場合，効率的フロンティアは接点ポートフォリオと安全資産からなる効率的フロンティア(直線)であり，リスク回避的な投資家は，その効率的フロンティア上にあるポートフォリオを選択しようとする。\n効率的フロンティア上の点は、安全資産と接点ポートフォリオの投資比率によって決定される。 効率的フロンティア上では，接点ポートフォリオを構成するリスク資産の投資比率は同一である。\n\n\n\n\n\n\n2基金分離定理\n\n\n\n2基金分離（Two-Fund Separation）とは、効率的フロンティア上に存在する2つのポートフォリオに投資することで組成されるポートフォリオは、効率的フロンティア上に存在することを示した定理である。この定理より、フロンティア上の2つポートフォリオを見つけることができれば、効率的フロンティア上のすべてのポートフォリオを再現できることがわかる。投資信託定理とも呼ばれる。\n\n\n次のような投資家の期待効用関数を仮定する。\n\n\\mathbb{E}{U} = \\mu _p - \\frac{\\gamma }{2} \\sigma _p^2\n\\tag{5.12}\nここで，\\gamma は絶対的リスク回避度であり，\\gamma が大きいほど，リスク回避的な投資家であることを示す。\n\n5.5.1 分離定理\n期待効用最大化を実現する最適なポートフォリオは，安全資産と接点ポートフォリオの投資比率を表しており，接点ポートフォリオを構成するリスク資産の投資率は，投資家の効用関数(投資家の選好)には依存しない。\nしたがって，接点ポートフォリオを見つけることができれば，投資家の決定問題は，安全資産と接点ポートフォリオの投資比率として表すことができる。 これを分離定理という。",
    "crumbs": [
      "ガイダンス",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>ポートフォリオ理論</span>"
    ]
  }
]