# 裁定価格理論

## 状態価格と資産価格

```{r setup}
pacman::p_load(tidyverse, ggthemes, knitr, kableExtra)
```

ここでは，<span class="markp">**裁定価格理論**(arbitrage pricing theory: APT)において重要な概念である**状態価格**(state price)</span>について説明します。
状態価格を理解するために、無裁定機会について学習します。

まずは次の例をみてみましょう。

:::{.callout-tip}
### 例1

- 今日( $t=0$ )から1年後( $t = 1$ )の状態について2通りの状態(状態1，状態2)が存在し，次のような2つの金融資産($A$，$B$)が存在する。
- 金融資産 $A$ を今日1単位購入すると，1年後に状態 1である場合，キャッシュフロー($CF_A$)として1千円が発生し，状態2である場合には，$CF_A$ は発生しない。
- 金融資産 $B$ を今日1単位購入すると，1年後に状態 1である場合，$CF_B$ は発生しないが，状態2である場合には，1千円の $CF_B$ が発生する。
- 2つの金融資産 $A$，$B$ の今日の価格 $P_A, P_B$ はそれぞれ $0.8$ 千円，$0.6$ 千円である。

ここで，もし金融資産 $C$ が存在し，1年後に状態1である場合には2千円のCFが発生し，状態2である場合には4千円のCFが発生するとき，金融資産Cの価格 $P_C$ はいくらになるか？
:::

まとめると次のような設定になります。

|  状態  |  資産AのCF  |  資産BのCF  |  資産CのCF  |
| ---- | ---- | ---- | ---- |
|  状態1  |  1  |  0  |  2  |
|  状態2  |  0  |  1  |  4  |

- 資産 $A$ : $P_A = 0.8$
- 資産 $B$ : $P_B = 0.6$
- 資産 $C$ : $P_C = ?$


ここで，金融資産Aを2単位，金融資産Bを4単位からなるポートフォリオPを考える。
このポートフォリオPの1年後のCFは，

- 状態1 : $CF_A \times 2 \text{単位}  + CF_B \times 4 \text{単位} = 2 \times 1 + 4 \times 0 = 2$
- 状態2 : $CF_A \times 2 \text{単位}  + CF_B \times 4 \text{単位} = 2 \times 0 + 4 \times 1 = 4$

よって，

1. 金融資産Cの1年後のCFは，ポートフォリオPの1年後のCFと同じ [^1]

**CFが同じなら，価値(価格)は同じ**になるなら，

2. 金融資産Cの価格 $P_C$は，ポートフォリオPの価格となる。よって

$$
P_C = P_A \times 2 + P_B \times 4 = 0.8 \times 2 + 0.6 \times 4 = 4.0
$$

[^1]: このとき金融資産CはポートフォリオPによって**複製される**という。

金融資産Cの価格が $P_C = 3.0$ ならどうなるのか，考えてみましょう。
投資戦略は，資産 $A$を2単位購入し，資産 $B$を4単位空売り，資産 $C$を1.5単位購入するとします。

$t=0$時点でのキャッシュフローは，

$$
0.8 \times 2 + 0.6 \times 4 - 3.0 \times 1.5 = 0
$$

となり， $t=1$ 時点でのキャッシュフローは，

- 状態1 : $- (1 \times 2 + 0 \times 4 + 2.0 \times 1.5) = 1$
- 状態2 : $- (0 \times 2 + 1 \times 4 + 4.0 \times 1.5) = 2$

すなわち，$t = 0$ において，$CF = 0$ でありながら，$t = 1$ 時点において，いずれの状態においても $CF > 0$ が実現できる。
これを**裁定機会(arbitrage opportunity)**という。

このような裁定機会が存在すると，市場参加者はその機会を利用して利益を得ることができるため，市場は効率的でないといえる。


次に，金融資産Cの価格 $P_C = 5.4$ ならどうなるか考えてみよう。

投資戦略は，金融資産Cを1単位空売り，金融資産Aを3.0単位，金融資産Bを5.0単位購入するとします。

$t=0$ 時点でのキャッシュフローは，

$$
5.4 \times 1 - (0.8 \times 3.0 + 0.6 \times 5.0) = 0
$$

となり，$t=1$ 時点でのキャッシュフローは，

- 状態1 : $- 2.0 \times 1 + ( 1.0 \times 3.0 + 0.0 \times 5.0) = 2$
- 状態2 : $- 4.0 \times 1 + ( 0.0 \times 3.0 + 1.0 \times 5.0) = 1$

すなわち，$t=0$ 時点において資金0でありながら，$t=1$ 時点のいずれの状態においても $CF > 0$ が実現できる。
これも裁定機会である。


## 無裁定機会

### 一物一価の法則の下での資産価格

APTでは裁定機会が存在しないと仮定します。
これをノー・フリーランチや一物一価の法則とも呼びます。

<span class="markp">無裁定機会が成立するとき，2つ以上の資産があって，それらの資産が同じCFを生み出すならば，それらの資産価格は同じになる。</span>

$$
\begin{aligned}
\text{金融資産Cの価格} P_C &= \text{ポートフォリオPの価格} \\
 &= 2.0 \times P_A + 4.0 \times P_B\\
 &= 2.0 \times 0.8 + 4.0 \times 0.6 = 4.0
\end{aligned}
$$

<span class="marky">金融資産Aは状態1が発生したときのみ1単位のCFを支払う金融資産</span>であり、<span class="markb">金融資産Bは状態2が発生したときのみ1単位のCFを支払う金融資産</span>である。
このような資産を**状態請求権付き証券**(state-contingent claim)とか**アロー・ドブリュー証券**(A-D証券)という。
A-D証券の現在の価格のことを**状態価格**(state price)という
(上の例では、$P_A = 1.0$、 $P_B = 0.6$ )。
状態価格のベクトルのことを状態価格ベクトルという。
<span class="markp">状態価格は正の値を取る</span>。

### 一物一価の法則と市場均衡

金融資産Cの価格が $P_C = 3.0$ ならば、投資家は高い価格の資産(あるいはポートフォリオ)を空売りし、安い価格の資産(金融資産C)を購入する裁定取引を行おうとする。
したがって、金融資産Cに対する需要が上昇し、金融資産Cの価格が上昇する。

いま、金融資産Cの価格を $P_C = 5.4$ とすると、投資家は金融資産Cを空売りし、安い価格の資産(ポートフォリオ)を購入する裁定取引を行おうとする。
したがって、金融資産Cに対する需要は低下し、金融資産Cの価格が下落する。

金融資産Cの価格を $P_C = 4.0$ とすると、投資家には裁定取引を行う機会がない。したがって、金融資産に対する需要に変化はなく、結果価格も変化しない。
すなわち、<span class="markp">金融資産Cの市場は均衡状態にある</span>。

言い換えると、<span class="marky">一物一価の法則が成立するとき、市場の需給は均衡状態にある</span>。

## 資産価格と状態価格

### 状態価格を用いた資産価格の導出

状態価格ベクトル $(q_1 , \dots , q_M)$ が与えられているとき、裁定機会が存在しない状況下において、ある金融資産の将来CFのベクトル $(D_1, \dots , D_M)$ をA-D証券のポートフォリオを用いて表現することができます。
そして、金融資産の価格は状態価格ベクトルと第1期のCFベクトルとの内積となります。

:::{.callout-tip}
### 例2 : 状態数2のケース

\begin{aligned}
P_C  &=
\begin{pmatrix}
q_1 & q_2
\end{pmatrix}
\begin{pmatrix}
D_1 \\
D_2
\end{pmatrix}
\\
& = q_1 D_1 + q_2 D_2 \\
& = 0.8 \times 2 + 0.6 \times 4 \\
& = 4.0
\end{aligned}
:::


:::{.callout-tip}
### 例3 : 状態数4のケース

今日($t=0$)から1年後($t=1$)の状態について4通りのシナリオ(状態1〜状態4)が考えられるとする。
状態価格ベクトルが $(1.0\  0.7\  0.5\  1.2)$ で表されるとき、1年後のCFベクトルが $(1\  5 \  3 \  1)$ となる金融資産の価格 $P_D$ を求めましょう。

$$
\begin{aligned}
P_D  &=
\begin{pmatrix}
1.0 & 0.7 & 0.5 & 1.2
\end{pmatrix}
\begin{pmatrix}
1 \\
5 \\
3 \\
1
\end{pmatrix}
\\
&= 1.0 \times 1 + 0.7 \times 5 + 0.5 \times 3 + 1.2 \times 1 \\
&= 7.2
\end{aligned}
$$


:::


### まとめ

状態数が$M$であり、状態価格ベクトルが $\boldsymbol{q}^{\top} = (q_1, \dots, q_M)$ 、資産 $i$ のCFベクトルが $\boldsymbol{D}_i = (D_{i,1}, \dots, D_{i,M})$ ならば、資産 $i$ の価格 $P_i$ は次のように表される。

$$
\begin{aligned}
P_i &= \boldsymbol{q}^{\top} \boldsymbol{D}_i \\
    &= q_1 D_{i,1} + \dots + q_M D_{i,M} \\
    &= \sum_{m=1}^{M} q_m D_{i,m}
\end{aligned}
$${#eq-04}

@eq-04 は、状態価格ベクトルを知ることができれば、資産価格を計算できることを示している。

### 応用：コール・オプションとプット・オプション

オプション取引とは，，原資産（対象資産）を，<span class="markp">将来の一定期日までに，特定の価格（権利行使価格）で売り付け・買い付けをする権利（オプション）の取引</span>をいう。
原資産を買う権利についてのオプションを**コール**，売る権利についてのオプションを**プット**という。

権利行使価格を $K$ (一定の値)，満期日 $T$における対象商品の価格を $S_T$ とすると，満期日におけるコール・オプションのCFは，

$$
\begin{aligned}
\begin{cases}
S_T - K & \text{if } S_T > K \text{のとき権利を行使} \\
0 & \text{if } S_T \leq K \text{のとき権利を放棄}
\end{cases}
\end{aligned}
$$
より，
$$
\max(S_T - K, 0)
$$
となる。

図にすると次のようになる。

```{r}
# データの準備
df <- data.frame(
    ST = seq(0, 100, 1) # 証券価格
)
df$call <- pmax(df$ST - 40, 0) # コールオプションのCFを計算
ggplot(df) + aes(x = ST, y = call) + geom_line(color = "magenta") +
    xlab("満期日Tにおける対象商品の価格ST") + ylab("オプションのCF") +
    xlim(0, 100) + ylim(0, 60) +
    theme_bw(base_family = "HiraKakuProN-W3")
```


つぎに，満期日におけるプット・オプションのCFは，

$$
\begin{aligned}
\begin{cases}
0       & \text{if } S_T > K \text{のとき権利を放棄} \\
K - S_T & \text{if } S_T \leq K \text{のとき権利を行使}
\end{cases}
\end{aligned}
$$
より，
$$
\max(K - S_T, 0)
$$
となる。

図にすると，

```{r}
df <- df |>
    mutate(
        put = pmax(40 - ST, 0)
    )
ggplot(df) + aes(x = ST, y = put) + geom_line(color = "darkblue") +
    xlab("満期日Tにおける対象商品の価格ST") + ylab("オプションのCF") +
    xlim(0, 100) + ylim(0, 60) +
    theme_bw(base_family = "HiraKakuProN-W3")
```

また，オプションには権利行使のタイミングにより，ヨーロピアン・オプションとアメリカン・オプションに分けられる。
権利行使がオプション**満期日**のみに限定されているオプションを**ヨーロピアン・オプション**といい，権利行使がオプション満期日までの期間であれば**いつでも行使できる**オプションを**アメリカン・オプション**といいます。

またオプション取引の買い方が権利行使したときに利益が生じる状態のことを，**イン・ザ・マネー**という。
コール・オプションでは，権利行使価格 $K$ が対象資産の価格 $S_T$ より下回る場合($K < S_T$)，プット・オプションでは，権利行使価格 $K$ が対象資産の価格 $S_T$ より上回る場合( $K > S_T$ )が**イン・ザ・マネー**である。

オプション取引の買い方が権利行使したときに損失が生じる状態のことを，**アウト・オブ・ザ・マネー**といい，何の損益も生じない状態のことを，**アット・ザ・マネー**といいます。


:::{.callout-tip}
### 例4 : コール・オプションの価格

今日($t=0$)から1年後($t=1$)の状態について5通りのシナリオ(状態1，状態2，状態3，状態4，状態5)が存在し，状態価格ベクトル$(q_1, q_2, q_3, q_4, q_5) = (0.15, 0.15, 0.15, 0.24, 0.27)$が与えられているとする。
X社株式と株式Xのコール・オプションについてのCFが，以下の表のように与えられているとき，X社の株価，コール・オプションの価格を求めましょう。

| 資産 | 状態1 | 状態2 | 状態3 | 状態4 | 状態5 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| X社株式 | 8 | 6 | 3 | 0 | 0 |
| コールX ($K=2$) | 6 | 4 | 1 | 0 | 0 |
| コールX ($K=4$) | 4 | 2 | 0 | 0 | 0 |

:::

:::{.callout-note collapse="true"}
### 解答

価格は状態価格ベクトルとCFベクトルの内積で計算できます。
つまり，
$$
P_i = \sum _{m = 1}^M q_m D_{i,m}
$$
で計算できるため，次のように株価とオプション価格を計算します。

X社の株価 $P_X$ は，

$$
0.15 \times 8 + 0.15 \times 6 + 0.15 \times 3 + 0.24 \times 0 + 0.27 \times 0 = 2.55
$$

となり，コール・オプションの価格は次のように計算されます。
$K=2$ の場合，

$$
0.15 \times 6 + 0.15 \times 4 + 0.15 \times 1 + 0.24 \times 0 + 0.27 \times 0 = 1.65
$$

$K=4$ の場合，

$$
0.15 \times 4 + 0.15 \times 2 + 0.15 \times 0 + 0.24 \times 0 + 0.27 \times 0 = 0.9
$$

となる。
:::


:::{.callout-tip}
### 例5 : プット・オプションの価格

今日($t=0$)から1年後($t=1$)の状態について5通りのシナリオ(状態1，状態2，状態3，状態4，状態5)が存在し，状態価格ベクトル$(q_1, q_2, q_3, q_4, q_5) = (0.15, 0.15, 0.15, 0.24, 0.27)$が与えられているとする。
X社株式と株式Xのプット・オプションについてのCFが，以下の表のように与えられているとき，X社の株価，プット・オプションの価格を求めましょう。

| 資産 | 状態1 | 状態2 | 状態3 | 状態4 | 状態5 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| X社株式 | 8 | 6 | 3 | 0 | 0 |
| プットX ($K=2$) | 0 | 0 | 0 | 2 | 2 |
| プットX ($K=4$) | 0 | 0 | 1 | 4 | 4 |

:::


:::{.callout-note collapse="true"}
### 解答

プット・オプションの価格は次のように計算されます。

$K=2$ の場合，

$$
0.15 \times 0 + 0.15 \times 0 + 0.15 \times 0 + 0.24 \times 2 + 0.27 \times 2 = 1.02
$$

$K=4$ の場合，

$$
0.15 \times 0 + 0.15 \times 0 + 0.15 \times 1 + 0.24 \times 4 + 0.27 \times 4 = 2.19
$$

となります。

:::

オプション価格と権利行使価格 $K$ との関係は次のようになります。
コール・オプションにおいては，権利行使価格 $K$ が上昇すると，オプション価格は減少します。
プット・オプションにおいては，権利行使価格 $K$ が上昇すると，オプション価格は増加します。

### 応用2：先物取引と先渡し取引

先物取引(フューチャーズ取引)や先渡し取引(フォーワード取引)とは，**事前に設定した取引条件で**将来の一定期日に原資産（対象資産）の売買を行う契約を結ぶことである。
約定した受渡価格を $K$ ，満期日 $T$ における対象商品の価格を $S_T$ とすると，満期日に先物取引の買い方には， $S_T - K$ の価値が生じ，売り手には$K - S_T$の価値が生じる。

先物取引と先渡し取引の違いは，前者は取引が金融商品取引所を通じて行われるのに対して，後者は相対取引となることである。

図にすると，次のようになります。


```{r}
# 先物取引 K = 40 の買いポジションのペイオフ
K = 40
K <- 40
ST <- seq(0, 100, 1) # 証券価格

df <- data.frame(
    ST = ST,  # STをデータフレームに含める
    futures = ST - K,
    forward = K - ST
)

# データをlong形式に変換（凡例をつけるため）
df_long <- reshape2::melt(df, id.vars = "ST", variable.name = "Position", value.name = "Payoff")

# グラフの描画
ggplot(df_long, aes(x = ST, y = Payoff, color = Position)) +
    geom_line() +
    scale_color_manual(values = c("futures" = "magenta", "forward" = "blue"),
                       labels = c("買いポジション", "売りポジション")) +
    xlab("満期日Tにおける対象商品の価格ST") +
    ylab("先物取引のCF") +
    xlim(0, 100) +
    ylim(-50, 50) +
    theme_bw(base_family = "HiraKakuProN-W3")
```










## 状態価格の導出

ここまで状態価格は所与(given)として議論してきましたが，任意の証券から状態価格を求めることができます。

@eq-24 より，資産 $i$ $i = 1, \dots, N$ について，以下の式が成立します。

$$
P_i = \sum_{m=1}^{M} q_m D_{i,m}
$$

行列で表現すると，

$$
\begin{aligned}
\begin{pmatrix}
P_1 \\
P_2 \\
\vdots \\
P_N
\end{pmatrix}
=
\begin{pmatrix}
D_{1,1} & D_{1,2} & \dots & D_{1,M} \\
D_{2,1} & D_{2,2} & \dots & D_{2,M} \\
\vdots & \vdots & \ddots & \vdots \\
D_{N,1} & D_{N,2} & \dots & D_{N,M} \\
\end{pmatrix}
\begin{pmatrix}
q_1 \\
q_2 \\
\vdots \\
q_M
\end{pmatrix}
\end{aligned}
$$

まとめて書くと，

$$
\begin{aligned}
\underset{N \times 1}{\boldsymbol{P}} = \underset{N \times M}{\boldsymbol{D}} \underset{N \times 1}{\boldsymbol{q}}
\end{aligned}
$$ {#eq-27}

:::{.callout-important}
### 定理 状態価格の存在定理

市場において，無裁定機会が成立していることは，@eq-27 式を満たす状態価格ベクトル $\boldsymbol{q}$ が存在することと**同値**である。

証明はテキスト第5章を参照
:::



